<ul class="button-group tagging">
  <% if @version %>
    <% if APPLICATION_ENVS.include?(:production) %>
      <% if @version.production? %>
        <li>
          <%= link_to "Untag as Production", send(:"#{versionable_path}_path", versionable, @version, version: {tags: (Array(@version.tags) - ["production"]).uniq}), method: :put, class: "button expand small production" %>
        </li>
      <% else %>
        <li>
          <%= link_to "Tag as Production", send(:"#{versionable_path}_path", versionable, @version, version: {tags: (Array(@version.tags) + ["production"]).uniq}), method: :put, class: "button expand small production" %>
        </li>
      <% end %>
    <% end %>

    <% if APPLICATION_ENVS.include?(:staging) %>
      <% if @version.staging? %>
        <li>
          <%= link_to "Untag as Staging", send(:"#{versionable_path}_path", versionable, @version, version: {tags: (Array(@version.tags) - ["staging"]).uniq}), method: :put, class: "button expand small" %>
        </li>
      <% else %>
        <li>
          <%= link_to "Tag as Staging", send(:"#{versionable_path}_path", versionable, @version, version: {tags: (Array(@version.tags) + ["staging"]).uniq}), method: :put, class: "button expand small" %>
        </li>
      <% end %>
    <% end %>
  <% end %>
</ul>

<div id="versions">
  <% versionable.versions.desc(:created_at).each_with_index do |version, index| %>
    <div class="version <%= 'active' if @version.try(:id) == version.id %> <%= 'hidden' if index > 15 %>">
      <%= link_to version.message || "No message",  send(:"#{versionable_path}_path", versionable, version) %>
      <p><%= l(version.created_at, format: :short) %> by <%= version.user.try(:first_name) %></p>

      <%= environment_tags(version, versionable) %>
    </div>
  <% end %>
  <% if versionable.versions.count > 15 %>
    <button class="button show_more secondary expand small"> Click to show all versions...</button>
  <% end %>
</div>
