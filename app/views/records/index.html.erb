<% if @previewer.record? %>

  <% if @previewer.document? %>
    <% if @previewer.field_errors? %>
      <h3>Errors</h3>
      <%= @previewer.field_errors_output %>
    <% end %>

    <% if @previewer.validation_errors? %>
      <h3>Validation Errors</h3>
      
      <%= @previewer.record.errors.inspect %>

      <ul>
        <% @previewer.record.errors.each do |attribute, message| %>
          <li><strong><%= attribute %>: </strong> <%= message %></li>
        <% end %>
      </ul>
    <% end %>

    <div id="record-attributes">
      <h3 class="left">Record attributes</h3>

      <div class="preview-navigation">
        <%= link_to_previous @parser.id, params[:index], class: "records-preview-button arrow arrow-left" %>
        <%= link_to_next @parser.id, params[:index], class: "records-preview-button arrow arrow-right" %>
      </div>

      <%= link_to "Raw data", "#", id: "record-raw-data-button", class: "button new-right" %>

      <%= @previewer.attributes_output %>
    </div>

    <div id="record-raw-data">
      <h3 class="left">Raw Data</h3>

      <div class="preview-navigation">
        <%= link_to_previous @parser.id, params[:index], class: "records-preview-button arrow arrow-left" %>
        <%= link_to_next @parser.id, params[:index], class: "records-preview-button arrow arrow-right" %>
      </div>

      <%= link_to "Record attributes", "#", id: "record-attributes-button", class: "button new-right" %>

      <%= @previewer.raw_output %>
    </div>
  <% else %>
    <h3>Error while building the record</h3>

    <%= @previewer.document_error  %>
  <% end %>

<% elsif @previewer.syntax_error %>

  <h3>Syntax error in the parser configuration</h3>
  <%= @previewer.syntax_error %>

<% elsif @previewer.fetch_error %>
  
  <h3>Error while fetching the records</h3>
  <h5><%= @previewer.fetch_error %></h5>

  <ul>
    <% @previewer.fetch_error_backtrace.each do |backtrace| %>
      <li><%= backtrace %></li>
    <% end %>
  </ul>

<% else %>
  <h3><%= @parser.name %> <span>didn't return any records.</span></h3>
<% end %>